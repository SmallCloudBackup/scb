function Scheduler() {
  var jackrabbit = require("jackrabbit");
  var self = this;
  var logger = console;

  this.queue = jackrabbit(process.env.CLOUDAMQP_URL)
  .on('connected', function() {
    logger.log({ type: 'info', msg: 'connected', service: 'rabbitmq' });
    ready();
  })
  .on('error', function(err) {
    logger.log({ type: 'error', msg: err, service: 'rabbitmq' });
  })
  .on('disconnected', function() {
    logger.log({ type: 'error', msg: 'disconnected', service: 'rabbitmq' });
    lost();
  });

  this.start = function (args) {
    console.log("Queuing new backup job: " + args.join(" "));
    this.jobId = args[0];
  }
  //

  function ready() {
    console.log("ready");
    self.queue.create("main", { durable: true }, function () {send();} );
  }

  function lost() {
    logger.log("connection lost");
  }

  function send() {
    console.log("send to main queue");
    self.queue.publish("main", { jobId: "booo" });
  }
}

module.exports = new Scheduler();
